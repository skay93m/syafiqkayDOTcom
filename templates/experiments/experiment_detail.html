{% extends 'base/index.html' %}
{% load static %}
{% load furigana_extras %}

{% block title %}{{ experiment.title }} - Experiments Laboratory{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'experiments:dashboard' %}">ğŸ§ª Experiments</a></li>
            <li class="breadcrumb-item"><a href="{% url 'experiments:dashboard' %}" class="jp-text japanese-text">ğŸ§ª <ruby>å®Ÿé¨“<rt>ã˜ã£ã‘ã‚“</rt></ruby></a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ experiment.title }}</li>
        </ol>
    </nav>

    <!-- Header Section -->
    <div class="row mb-5">
        <div class="col-md-8">
            <h1 class="display-5 mb-3">{{ experiment.title }}</h1>
            <p class="lead text-muted">{{ experiment.description }}</p>
        </div>
        <div class="col-md-4 text-end">
            <!-- Status Badge -->
            <div class="mb-3">
                {% if experiment.status == 'conceptualizing' %}
                <span class="badge bg-secondary fs-5">ğŸ’­ Conceptualizing</span>
                <div class="jp-text japanese-text"><small><ruby>æ§‹æƒ³<rt>ã“ã†ãã†</rt></ruby><ruby>ä¸­<rt>ã¡ã‚…ã†</rt></ruby></small></div>
                {% elif experiment.status == 'designing' %}
                <span class="badge bg-primary fs-5">ğŸ“ Designing</span>
                <div class="jp-text japanese-text"><small><ruby>è¨­è¨ˆ<rt>ã›ã£ã‘ã„</rt></ruby><ruby>ä¸­<rt>ã¡ã‚…ã†</rt></ruby></small></div>
                {% elif experiment.status == 'testing' %}
                <span class="badge bg-warning fs-5">ğŸ§ª Testing</span>
                <div class="jp-text japanese-text"><small><ruby>å®Ÿé¨“<rt>ã˜ã£ã‘ã‚“</rt></ruby><ruby>ä¸­<rt>ã¡ã‚…ã†</rt></ruby></small></div>
                {% elif experiment.status == 'analyzing' %}
                <span class="badge bg-info fs-5">ğŸ“Š Analyzing</span>
                <div class="jp-text japanese-text"><small><ruby>åˆ†æ<rt>ã¶ã‚“ã›ã</rt></ruby><ruby>ä¸­<rt>ã¡ã‚…ã†</rt></ruby></small></div>
                {% elif experiment.status == 'completed' %}
                <span class="badge bg-success fs-5">âœ… Completed</span>
                <div class="jp-text japanese-text"><small><ruby>å®Œäº†<rt>ã‹ã‚“ã‚Šã‚‡ã†</rt></ruby></small></div>
                {% elif experiment.status == 'abandoned' %}
                <span class="badge bg-danger fs-5">âŒ Abandoned</span>
                <div class="jp-text japanese-text"><small><ruby>ä¸­æ­¢<rt>ã¡ã‚…ã†ã—</rt></ruby></small></div>
                {% endif %}
            </div>
            
            <!-- Meta Information -->
            <div class="text-muted">
                <small>
                    ğŸ“… Created: {{ experiment.created_at|date:"M d, Y" }}<br>
                    {% if experiment.updated_at != experiment.created_at %}
                    ğŸ”„ Updated: {{ experiment.updated_at|date:"M d, Y" }}<br>
                    {% endif %}
                    ğŸ“š {{ experiment.resources.count }} resource{{ experiment.resources.count|pluralize }}
                </small>
            </div>
            <div class="text-muted jp-text japanese-text">
                <small>
                    ğŸ“… <ruby>ä½œæˆ<rt>ã•ãã›ã„</rt></ruby>: {{ experiment.created_at|date:"Yå¹´mæœˆdæ—¥" }}<br>
                    {% if experiment.updated_at != experiment.created_at %}
                    ğŸ”„ <ruby>æ›´æ–°<rt>ã“ã†ã—ã‚“</rt></ruby>: {{ experiment.updated_at|date:"Yå¹´mæœˆdæ—¥" }}<br>
                    {% endif %}
                    ğŸ“š {{ experiment.resources.count }}å€‹ã®<ruby>è³‡æ–™<rt>ã—ã‚Šã‚‡ã†</rt></ruby>
                </small>
            </div>
        </div>
    </div>

    <!-- Tags -->
    {% if experiment.tags %}
    <div class="mb-4">
        <h6>ğŸ·ï¸ Tags:</h6>
        <h6 class="jp-text japanese-text">ğŸ·ï¸ <ruby>ã‚¿ã‚°<rt>Tag</rt></ruby>:</h6>
        {% for tag in experiment.get_tag_list %}
        <span class="badge bg-secondary me-1">{{ tag }}</span>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Experiment Content -->
    <div class="row">
        <div class="col-lg-8">
            <!-- Hypothesis -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="card-title mb-0">ğŸ¯ Hypothesis</h4>
                    <h5 class="card-subtitle mb-0 jp-text japanese-text">ğŸ¯ <ruby>ä»®èª¬<rt>ã‹ã›ã¤</rt></ruby></h5>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ experiment.hypothesis|linebreaks }}</p>
                </div>
            </div>

            <!-- Methodology -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h4 class="card-title mb-0">ğŸ”¬ Methodology</h4>
                    <h5 class="card-subtitle mb-0 jp-text japanese-text">ğŸ”¬ <ruby>æ–¹æ³•è«–<rt>ã»ã†ã»ã†ã‚ã‚“</rt></ruby></h5>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ experiment.methodology|linebreaks }}</p>
                </div>
            </div>

            <!-- Results (if available) -->
            {% if experiment.results %}
            <div class="card mb-4">
                <div class="card-header bg-warning text-white">
                    <h4 class="card-title mb-0">ğŸ“Š Results</h4>
                    <h5 class="card-subtitle mb-0 jp-text japanese-text">ğŸ“Š <ruby>çµæœ<rt>ã‘ã£ã‹</rt></ruby></h5>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ experiment.results|linebreaks }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Conclusions (if available) -->
            {% if experiment.conclusions %}
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h4 class="card-title mb-0">ğŸ’¡ Conclusions</h4>
                    <h5 class="card-subtitle mb-0 jp-text japanese-text">ğŸ’¡ <ruby>çµè«–<rt>ã‘ã¤ã‚ã‚“</rt></ruby></h5>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ experiment.conclusions|linebreaks }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Resources -->
            {% if experiment.resources.exists %}
            <div class="card mb-4">
                <div class="card-header bg-secondary text-white">
                    <h4 class="card-title mb-0">ğŸ“š Resources</h4>
                    <h5 class="card-subtitle mb-0 jp-text japanese-text">ğŸ“š <ruby>è³‡æ–™<rt>ã—ã‚Šã‚‡ã†</rt></ruby></h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        {% for resource in experiment.resources.all %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">
                                    <a href="{{ resource.url }}" target="_blank" class="text-decoration-none">
                                        ğŸ”— {{ resource.title }}
                                    </a>
                                </h6>
                                <small class="text-muted">{{ resource.created_at|date:"M d, Y" }}</small>
                                <small class="text-muted jp-text japanese-text">{{ resource.created_at|date:"Yå¹´mæœˆdæ—¥" }}</small>
                            </div>
                            {% if resource.description %}
                            <p class="mb-1 text-muted">{{ resource.description }}</p>
                            {% endif %}
                            <small class="text-muted">{{ resource.url }}</small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Progress Status -->
            {% if experiment.status != 'completed' and experiment.status != 'abandoned' %}
            <div class="alert alert-info">
                <h5 class="alert-heading">ğŸš§ Experiment in Progress</h5>
                <p class="mb-0">
                    This experiment is currently in the <strong>{{ experiment.get_status_display }}</strong> phase. 
                    Check back later for updates on results and conclusions.
                </p>
                <div class="jp-text japanese-text mt-2">
                    <h6 class="alert-heading">ğŸš§ <ruby>å®Ÿé¨“<rt>ã˜ã£ã‘ã‚“</rt></ruby><ruby>é€²è¡Œ<rt>ã—ã‚“ã“ã†</rt></ruby><ruby>ä¸­<rt>ã¡ã‚…ã†</rt></ruby></h6>
                    <p class="mb-0">
                        ã“ã®<ruby>å®Ÿé¨“<rt>ã˜ã£ã‘ã‚“</rt></ruby>ã¯<ruby>ç¾åœ¨<rt>ã’ã‚“ã–ã„</rt></ruby><strong>{{ experiment.get_status_display }}</strong><ruby>æ®µéš<rt>ã ã‚“ã‹ã„</rt></ruby>ã«ã‚ã‚Šã¾ã™ã€‚
                        <ruby>çµæœ<rt>ã‘ã£ã‹</rt></ruby>ã¨<ruby>çµè«–<rt>ã‘ã¤ã‚ã‚“</rt></ruby>ã®<ruby>æ›´æ–°<rt>ã“ã†ã—ã‚“</rt></ruby>ã«ã¤ã„ã¦ã¯<ruby>å¾Œ<rt>ã‚ã¨</rt></ruby>ã§ã”<ruby>ç¢ºèª<rt>ã‹ãã«ã‚“</rt></ruby>ãã ã•ã„ã€‚
                    </p>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Experiment Progress -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">ğŸ“ˆ Progress</h5>
                    <h6 class="card-subtitle mb-0 jp-text japanese-text">ğŸ“ˆ <ruby>é€²æ—<rt>ã—ã‚“ã¡ã‚‡ã</rt></ruby></h6>
                </div>
                <div class="card-body">
                    <div class="progress-steps">
                        <div class="step {% if experiment.status == 'conceptualizing' %}active{% else %}completed{% endif %}">
                            <div class="step-icon">ğŸ’­</div>
                            <div class="step-label">Conceptualizing</div>
                            <div class="step-label-jp jp-text japanese-text"><ruby>æ§‹æƒ³<rt>ã“ã†ãã†</rt></ruby></div>
                        </div>
                        <div class="step {% if experiment.status == 'designing' %}active{% elif experiment.status == 'testing' or experiment.status == 'analyzing' or experiment.status == 'completed' %}completed{% endif %}">
                            <div class="step-icon">ğŸ“</div>
                            <div class="step-label">Designing</div>
                            <div class="step-label-jp jp-text japanese-text"><ruby>è¨­è¨ˆ<rt>ã›ã£ã‘ã„</rt></ruby></div>
                        </div>
                        <div class="step {% if experiment.status == 'testing' %}active{% elif experiment.status == 'analyzing' or experiment.status == 'completed' %}completed{% endif %}">
                            <div class="step-icon">ğŸ§ª</div>
                            <div class="step-label">Testing</div>
                            <div class="step-label-jp jp-text japanese-text"><ruby>å®Ÿé¨“<rt>ã˜ã£ã‘ã‚“</rt></ruby></div>
                        </div>
                        <div class="step {% if experiment.status == 'analyzing' %}active{% elif experiment.status == 'completed' %}completed{% endif %}">
                            <div class="step-icon">ğŸ“Š</div>
                            <div class="step-label">Analyzing</div>
                            <div class="step-label-jp jp-text japanese-text"><ruby>åˆ†æ<rt>ã¶ã‚“ã›ã</rt></ruby></div>
                        </div>
                        <div class="step {% if experiment.status == 'completed' %}active{% endif %}">
                            <div class="step-icon">âœ…</div>
                            <div class="step-label">Completed</div>
                            <div class="step-label-jp jp-text japanese-text"><ruby>å®Œäº†<rt>ã‹ã‚“ã‚Šã‚‡ã†</rt></ruby></div>
                        </div>
                        {% if experiment.status == 'abandoned' %}
                        <div class="step active">
                            <div class="step-icon">âŒ</div>
                            <div class="step-label">Abandoned</div>
                            <div class="step-label-jp jp-text japanese-text"><ruby>ä¸­æ­¢<rt>ã¡ã‚…ã†ã—</rt></ruby></div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">ğŸ”§ Actions</h5>
                    <h6 class="card-subtitle mb-0 jp-text japanese-text">ğŸ”§ <ruby>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³<rt>Action</rt></ruby></h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'experiments:dashboard' %}" class="btn btn-outline-primary">
                            â† Back to Dashboard
                        </a>
                        <a href="{% url 'experiments:dashboard' %}" class="btn btn-outline-primary btn-sm jp-text japanese-text">
                            â† <ruby>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰<rt>Dashboard</rt></ruby>ã«<ruby>æˆ»<rt>ã‚‚ã©</rt></ruby>ã‚‹
                        </a>
                        <a href="/admin/experiments/experiment/{{ experiment.id }}/change/" class="btn btn-outline-secondary">
                            âš™ï¸ Edit Experiment
                        </a>
                        <a href="/admin/experiments/experiment/{{ experiment.id }}/change/" class="btn btn-outline-secondary btn-sm jp-text japanese-text">
                            âš™ï¸ <ruby>å®Ÿé¨“<rt>ã˜ã£ã‘ã‚“</rt></ruby>ã‚’<ruby>ç·¨é›†<rt>ã¸ã‚“ã—ã‚…ã†</rt></ruby>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Removed a4-width constraint for full-width layout */

.progress-steps {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.step {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    border-radius: 6px;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
}

.step.active {
    background-color: #e3f2fd;
    border-color: #2196f3;
}

.step.completed {
    background-color: #e8f5e8;
    border-color: #4caf50;
}

.step-icon {
    margin-right: 8px;
    font-size: 1.2em;
}

.step-label {
    font-weight: 500;
}

.step-label-jp {
    font-size: 0.8em;
    color: #666;
    margin-top: 2px;
}

.card {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.card-header {
    border-bottom: 1px solid #dee2e6;
}

.jp-text {
    font-size: 0.9em;
    color: #666;
}
</style>
{% endblock %}
